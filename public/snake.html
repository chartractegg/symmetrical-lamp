<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake — Nokia 3310 Edition</title>
<style>
  body {
    background-color: #c0c0c0;
    font-family: "Courier New", monospace;
    color: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
  }
  pre.phone {
    font-size: 12px;
    line-height: 12px;
    color: #000;
    text-align: center;
    white-space: pre;
    margin-bottom: 8px;
  }
  .screen {
    background-color: #5a7751;
    width: 240px;
    height: 320px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 4px solid #3a4a3a;
    box-shadow: inset 2px 2px 0 #7f9f7f, inset -2px -2px 0 #2f3f2f;
    touch-action: manipulation;
    position: relative;
  }
  canvas {
    background-color: #5a7751;
    display: block;
  }
  .score {
    font-weight: bold;
    font-size: 14px;
    margin-top: 8px;
  }
</style>
</head>
<body>
<pre class="phone">
 ________________________________________
|                                        |
|    ┌──────────────────────────────┐    |
|    │                              │    |
|    │          NOKIA 3310          │    |
|    │                              │    |
|    └──────────────────────────────┘    |
|                ________                |
|               |        |               |
|               | SCREEN |               |
|               |________|               |
|                                        |
|________________________________________|
</pre>

<div class="screen" id="screen">
  <canvas id="game" width="240" height="320"></canvas>
</div>
<div class="score">Score: <span id="score">0</span></div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const screen = document.getElementById('screen');
  const cellSize = 10;
  const rows = canvas.height / cellSize;
  const cols = canvas.width / cellSize;
  
  let snake = [{x: 12, y: 16}];
  let dir = {x: 1, y: 0};
  let apple = randomApple();
  let score = 0;
  let speed = 150;
  let interval;
  let pendingDir = null;

  document.addEventListener('keydown', e => {
    switch (e.key) {
      case 'ArrowUp': case 'w': if (dir.y === 0) dir = {x:0,y:-1}; break;
      case 'ArrowDown': case 's': if (dir.y === 0) dir = {x:0,y:1}; break;
      case 'ArrowLeft': case 'a': if (dir.x === 0) dir = {x:-1,y:0}; break;
      case 'ArrowRight': case 'd': if (dir.x === 0) dir = {x:1,y:0}; break;
    }
  });

  // Touch controls: detect tap quadrant
  screen.addEventListener('touchstart', e => {
    const rect = screen.getBoundingClientRect();
    const touch = e.touches[0];
    const x = touch.clientX - rect.left;
    const y = touch.clientY - rect.top;
    const w = rect.width;
    const h = rect.height;
    const centerX = w / 2;
    const centerY = h / 2;
    
    // Determine direction by which quadrant was tapped
    let newDir = {...dir};
    const dx = x - centerX;
    const dy = y - centerY;
    const absX = Math.abs(dx);
    const absY = Math.abs(dy);
    if (absX > absY) {
      // Horizontal tap
      newDir = dx < 0 ? {x:-1, y:0} : {x:1, y:0};
    } else {
      // Vertical tap
      newDir = dy < 0 ? {x:0, y:-1} : {x:0, y:1};
    }

    // Apply only if valid (not reversing directly)
    if ((newDir.x !== -dir.x || newDir.y !== -dir.y) && pendingDir === null) {
      pendingDir = newDir;
    }
  });

  function randomApple() {
    return {
      x: Math.floor(Math.random() * cols),
      y: Math.floor(Math.random() * rows)
    };
  }

  function drawCell(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * cellSize, y * cellSize, cellSize - 1, cellSize - 1);
  }

  function loop() {
    if (pendingDir) {
      dir = pendingDir;
      pendingDir = null;
    }
    const head = {
      x: (snake[0].x + dir.x + cols) % cols,
      y: (snake[0].y + dir.y + rows) % rows
    };
    if (snake.some(s => s.x === head.x && s.y === head.y)) {
      clearInterval(interval);
      ctx.fillStyle = '#4a5f4a';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#aaffaa';
      ctx.font = "16px 'Courier New'";
      ctx.fillText("GAME OVER", 65, 150);
      ctx.fillText("Press Enter", 70, 170);
      document.addEventListener('keydown', restartOnce, {once:true});
      screen.addEventListener('touchstart', restartTouch, {once:true});
      return;
    }
    snake.unshift(head);
    if (head.x === apple.x && head.y === apple.y) {
      score++;
      scoreEl.textContent = score;
      apple = randomApple();
      if (speed > 60) {
        clearInterval(interval);
        speed -= 5;
        interval = setInterval(loop, speed);
      }
    } else {
      snake.pop();
    }

    ctx.fillStyle = '#5a7751';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    drawCell(apple.x, apple.y, '#aaffaa');
    for (const s of snake) drawCell(s.x, s.y, '#003300');
  }

  function restartOnce(e) {
    if (e.key === 'Enter') startGame();
  }
  function restartTouch() {
    startGame();
  }

  function startGame() {
    snake = [{x: 12, y: 16}];
    dir = {x: 1, y: 0};
    apple = randomApple();
    score = 0;
    scoreEl.textContent = 0;
    speed = 150;
    pendingDir = null;
    clearInterval(interval);
    interval = setInterval(loop, speed);
  }

  interval = setInterval(loop, speed);
})();
</script>
</body>
</html>
