<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackjack — 6‑Deck Shoe</title>
<style>
  :root{
    --bg:#0b1020;         /* page backdrop */
    --felt:#0e4b36;       /* table felt */
    --felt-dark:#0c3b2b;
    --rail1:#0a231c;      /* rail shadows */
    --rail2:#071812;
    --ink:#f1f5f9;        /* text */
    --muted:#9fb4c5;      /* muted text */
    --panel:#151a2f;      /* controls panel */
    --accent:#66d9a3;     /* highlight */

    --card:#ffffff;       /* card face */
    --card-edge:#b9c1c9;  /* card border */
    --red:#c1121f;        /* hearts/diamonds */
    --black:#0b0b0b;      /* spades/clubs true black */

    --chip-body:#d32f2f;  /* primary chip color */
    --chip-core:#fff4e6;
    --chip-edge:#0f172a;  /* chip border */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 700px at 15% 0%,#171b3a 0%,var(--bg) 60%);color:var(--ink);font:15px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:grid;grid-template-rows:auto 1fr auto;min-height:100vh}
  .wrap{width:min(98vw,1100px);margin-inline:auto}

  header{display:flex;justify-content:space-between;align-items:center;margin:10px 0 12px 0;padding-inline:8px}
  h1{font-size:18px;margin:0}
  .stats{display:flex;gap:10px;flex-wrap:wrap}
  .badge{background:var(--panel);border:1px solid #2a3159;padding:6px 10px;border-radius:999px;color:var(--muted)}
  .bold{font-weight:700;color:var(--ink)}

  .table{position:relative;border-radius:24px;background:radial-gradient(1200px 600px at 60% -10%,#11694e 0%, var(--felt) 40%, var(--felt-dark) 100%);border:1px solid #0a2a22;padding:18px;box-shadow:0 18px 60px rgba(0,0,0,.35) inset, 0 14px 34px rgba(0,0,0,.45);overflow:hidden}
  .rail{position:absolute; inset:8px; border-radius:20px; box-shadow: 0 0 0 4px var(--rail1) inset, 0 0 0 8px var(--rail2) inset; pointer-events:none}

  .layout{display:grid;grid-template-columns:1.1fr 220px;gap:16px}
  .right{display:grid;gap:12px;align-content:start}
  .shoe,.tray{background:rgba(0,0,0,.25);border:1px solid #0d2520;border-radius:12px;padding:12px;min-height:110px;position:relative}
  .shoe::before{content:"Shoe";position:absolute;top:6px;left:10px;color:#cbd5e1;font-size:12px;opacity:.7}
  .tray::before{content:"Discard";position:absolute;top:6px;left:10px;color:#cbd5e1;font-size:12px;opacity:.7}

  .stage{position:relative;min-height:420px;border-radius:12px;padding:10px}
  .dealer{display:grid;justify-items:center;margin-top:4px;margin-bottom:14px}
  .dealer .label{font-weight:700;letter-spacing:.5px;margin-bottom:6px}
  .players{display:grid;gap:12px}
  .hand{position:relative;background:transparent;border:0;padding:10px;min-height:120px} /* no green outline */
  .hand .label{display:flex;align-items:center;gap:8px;margin-bottom:6px}
  .bet-circle{position:absolute;bottom:8px;left:8px;width:60px;height:60px;border-radius:50%;display:grid;place-items:center}

  /* Casino chip */
  .chip{width:52px;height:52px;border-radius:50%;position:relative;display:grid;place-items:center;box-shadow:0 6px 12px rgba(0,0,0,.35)}
  .chip::before{content:"";position:absolute;inset:6px;border-radius:50%;background:radial-gradient(circle at 30% 30%, var(--chip-core) 0 30%, #ffe0b3 30% 60%, var(--chip-core) 60% 100%)}
  .chip::after{content:"";position:absolute;inset:0;border-radius:50%;background:conic-gradient(from 0deg, var(--chip-body) 0 10%, transparent 10% 20%, var(--chip-body) 20% 30%, transparent 30% 40%, var(--chip-body) 40% 50%, transparent 50% 60%, var(--chip-body) 60% 70%, transparent 70% 80%, var(--chip-body) 80% 90%, transparent 90% 100%);border:3px solid var(--chip-edge)}
  .chip.fly{position:fixed;left:0;top:0;will-change:transform}

  .cards{position:relative;display:flex;gap:8px;flex-wrap:wrap;min-height:96px}
  .card{width:64px;height:88px;border-radius:10px;border:1px solid var(--card-edge);background:var(--card);display:grid;place-items:center;position:relative;box-shadow:0 6px 14px rgba(0,0,0,.25)}
  .card.red .rank, .card.red .suit{color:var(--red)}
  .card.black .rank, .card.black .suit{color:var(--black)}
  .rank{font-weight:800;font-size:20px}
  .suit{font-weight:800;font-size:20px;margin-left:2px}
  .back{background:repeating-linear-gradient(45deg,#162042 0 8px,#0e1537 8px 16px);border-color:#2b335f}

  .msg{margin-top:8px;color:#e5eef8}
  .hint{color:#cbd5e1;font-size:12px;margin-top:6px;opacity:.8}

  /* Bottom action bar */
  .bottom-bar{position:sticky;bottom:0;left:0;right:0;background:rgba(12,16,32,.9);backdrop-filter:blur(4px);border-top:1px solid #2a3159;padding:10px}
  .actions{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
  .controls>*{background:var(--panel);color:var(--ink);border:1px solid #2a3159;padding:12px 16px;border-radius:12px;font-size:16px}
  .controls button{cursor:pointer}
  .controls button:disabled{opacity:.5;cursor:not-allowed}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Blackjack — 6‑Deck Shoe</h1>
      <div class="stats">
        <span class="badge">Bankroll: $<span id="bank" class="bold">1000</span></span>
        <span class="badge">Bet: $<span id="betDisp" class="bold">10</span></span>
        <span class="badge">Shoe: <span id="shoeLeft" class="bold">0</span></span>
      </div>
    </header>

    <div class="table">
      <div class="rail"></div>
      <div class="layout">
        <div class="stage">
          <div class="dealer">
            <div class="label">Dealer • <span id="dealerCardCount" class="badge"></span></div>
            <div id="dealerCards" class="cards"></div>
          </div>
          <div id="players" class="players"></div>
          <div id="msg" class="msg"></div>
        </div>
        <div class="right">
          <div class="shoe" id="shoe"> </div>
          <div class="tray" id="tray"> </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-bar">
    <div class="actions">
      <div class="stats">
        <span class="badge">Rules: 3:2 BJ · S17 · Split · Double · Surrender</span>
        <label for="bet" class="badge">Bet</label>
        <input id="bet" type="number" min="1" step="1" value="10" style="width:110px;background:var(--panel);color:var(--ink);border:1px solid #2a3159;border-radius:10px;padding:10px"/>
      </div>
      <div class="controls">
        <button id="deal">Deal</button>
        <button id="newShoe">New Shoe</button>
        <button id="hit" disabled>Hit</button>
        <button id="stand" disabled>Stand</button>
        <button id="double" disabled>Double</button>
        <button id="split" disabled>Split</button>
        <button id="surrender" disabled>Surrender</button>
      </div>
    </div>
  </div>

<script>
(()=>{
  // ===== Helpers =====
  const $ = id => document.getElementById(id);
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  const SUITS=['♠','♥','♦','♣'];
  const RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const DECKS=6, CUT=0.75; // reshuffle when ~25% remains
  const DEAL_MS = 600;     // card animation time
  const CHIP_MS = 600;     // chip animation time

  let shoe=[], discard=[];
  let bankroll=1000, bet=10;
  let dealer=[], hands=[];   // hands = [{cards, bet, finished}]
  let active=0, inRound=false, firstAction=true, holeDown=true;

  // UI refs
  const bankEl=$('bank'), betDisp=$('betDisp'), betInput=$('bet');
  const shoeLeftEl=$('shoeLeft');
  const dealerCardsEl=$('dealerCards'), dealerCountEl=$('dealerCardCount');
  const playersEl=$('players'), msgEl=$('msg');
  const shoeEl=$('shoe');
  const dealBtn=$('deal'), newShoeBtn=$('newShoe'), hitBtn=$('hit'), standBtn=$('stand'), doubleBtn=$('double'), splitBtn=$('split'), surrenderBtn=$('surrender');

  // ===== Deck/Shoe =====
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  function freshShoe(){ shoe=[]; discard=[]; for(let d=0; d<DECKS; d++){ for(const s of SUITS){ for(const r of RANKS){ shoe.push({rank:r,suit:s}); }}} shuffle(shoe); updateShoe(); }
  function updateShoe(){ shoeLeftEl.textContent = String(shoe.length); }
  function draw(){ if(!shoe.length) freshShoe(); const c = shoe.pop(); updateShoe(); return c; }

  // ===== Values =====
  const isRed = s => s==='♥' || s==='♦';
  function cardValue(r){ if(r==='A') return 11; if(['10','J','Q','K'].includes(r)) return 10; return parseInt(r,10); }
  function handValue(cards){ let t=0,a=0; for(const c of cards){ t+=cardValue(c.rank); if(c.rank==='A') a++; } while(t>21 && a>0){ t-=10; a--; } return {total:t, soft:a>0 && t<=21}; }
  const sameValue = (a,b) => cardValue(a.rank)===cardValue(b.rank);

  // ===== Render =====
  function cardNode(face){
    const el = document.createElement('div');
    el.className = 'card ' + (isRed(face.suit)?'red':'black');
    const r = document.createElement('span'); r.className='rank'; r.textContent=face.rank;
    const s = document.createElement('span'); s.className='suit'; s.textContent=face.suit;
    el.appendChild(r); el.appendChild(s);
    return el;
  }
  function backNode(){ const el=document.createElement('div'); el.className='card back'; return el; }

  function render(){
    // dealer
    dealerCardsEl.innerHTML='';
    if(dealer.length){
      dealerCardsEl.appendChild(cardNode(dealer[0]));
      if(holeDown){ dealerCardsEl.appendChild(backNode()); }
      else{ for(let i=1;i<dealer.length;i++) dealerCardsEl.appendChild(cardNode(dealer[i])); }
    }
    dealerCountEl.textContent = dealer.length + (holeDown? ' cards' : ' cards'); // always just card count

    // players (one seat, but may split)
    playersEl.innerHTML='';
    hands.forEach((h,i)=>{
      const wrap=document.createElement('div'); wrap.className='hand';
      const label=document.createElement('div'); label.className='label'; label.innerHTML = `<strong>Hand ${i+1}</strong> <span class="badge">${handValue(h.cards).total}</span>`;
      const cards=document.createElement('div'); cards.className='cards'; h.cards.forEach(c=>cards.appendChild(cardNode(c)));
      const betCircle=document.createElement('div'); betCircle.className='bet-circle'; betCircle.innerHTML = `<div class="chip"></div>`;
      wrap.appendChild(label); wrap.appendChild(cards); wrap.appendChild(betCircle);
      playersEl.appendChild(wrap); h.dom={wrap,cards,betCircle};
    });

    betDisp.textContent = String(bet);
    bankEl.textContent = String(bankroll);
  }

  // ===== Animations =====
  async function flyCard(toEl, face){
    const rf = shoeEl.getBoundingClientRect();
    const rt = toEl.getBoundingClientRect();
    const ghost = document.createElement('div');
    ghost.className = 'card ' + (face && face.suit ? (isRed(face.suit)?'red':'black') : '');
    if(face && face.rank){
      ghost.appendChild(Object.assign(document.createElement('span'),{className:'rank',textContent:face.rank}));
      ghost.appendChild(Object.assign(document.createElement('span'),{className:'suit',textContent:face.suit}));
    }
    ghost.style.position='fixed'; ghost.style.left=(rf.left+8)+'px'; ghost.style.top=(rf.top+8)+'px'; ghost.style.zIndex='9999';
    document.body.appendChild(ghost);
    const dx = rt.left - rf.left; const dy = rt.top - rf.top;
    await ghost.animate([{transform:'translate(0,0) scale(0.92)'},{transform:`translate(${dx}px,${dy}px) scale(1)`}],{duration:600,easing:'cubic-bezier(.2,.8,.2,1)'}).finished;
    ghost.remove();
  }
  async function flyChip(fromEl, toEl){
    const rf = fromEl.getBoundingClientRect();
    const rt = toEl.getBoundingClientRect();
    const chip = document.createElement('div'); chip.className='chip fly'; chip.style.left=(rf.left+6)+'px'; chip.style.top=(rf.top+6)+'px';
    document.body.appendChild(chip);
    const dx = rt.left - rf.left; const dy = rt.top - rf.top;
    await chip.animate([{transform:'translate(0,0)'},{transform:`translate(${dx}px,${dy}px)`}],{duration:600,easing:'cubic-bezier(.2,.8,.2,1)'}).finished;
    chip.remove();
  }

  // ===== Controls =====
  function enable(el,on){ el.disabled = !on; }
  function setStage(stage){
    if(stage==='idle'){
      enable(dealBtn,true); enable(newShoeBtn,true);
      [hitBtn,standBtn,doubleBtn,splitBtn,surrenderBtn].forEach(b=>enable(b,false));
    } else if(stage==='acting'){
      enable(dealBtn,false); enable(newShoeBtn,true);
      const h = hands[active];
      const canD = firstAction && bankroll>=h.bet;
      const canS = firstAction && h.cards.length===2 && bankroll>=h.bet && sameValue(h.cards[0],h.cards[1]);
      enable(hitBtn,true); enable(standBtn,true); enable(doubleBtn,canD); enable(splitBtn,canS); enable(surrenderBtn,firstAction);
    } else if(stage==='locked'){
      enable(dealBtn,true); enable(newShoeBtn,true);
      [hitBtn,standBtn,doubleBtn,splitBtn,surrenderBtn].forEach(b=>enable(b,false));
    }
  }

  function ensurePenetration(){ if(shoe.length < 52*DECKS*(1-CUT)) freshShoe(); }
  function msg(txt=''){ msgEl.textContent = txt; }

  // ===== Game flow =====
  async function startRound(){
    bet = Math.max(1, Math.floor(Number(betInput.value||10)));
    if(bet>bankroll){ msg('Bet exceeds bankroll'); return; }
    ensurePenetration();

    // init
    bankroll -= bet; hands=[{cards:[], bet, finished:false}]; dealer=[]; active=0; inRound=true; firstAction=true; holeDown=true; msg('');
    render();

    // chip to bet circle (visual)
    const bankBadge = bankEl.parentElement.parentElement; // outer badge
    await flyChip(bankBadge, playersEl);

    // deal sequence: P, D, P, D(hole)
    const p0 = draw(), d0 = draw(), p1 = draw(), d1 = draw();

    await flyCard(playersEl, p0); hands[0].cards.push(p0); render();
    await sleep(40);
    await flyCard(dealerCardsEl, d0); dealer.push(d0); render();
    await sleep(40);
    await flyCard(playersEl, p1); hands[0].cards.push(p1); render();
    await sleep(40);
    await flyCard(dealerCardsEl, {rank:'', suit:''}); dealer.push(d1); render();

    // Naturals
    if(handValue(hands[0].cards).total===21 || dealerPeekBJ()) { await finishRound(); return; }
    setStage('acting');
  }

  function dealerPeekBJ(){
    const up = dealer[0]?.rank; if(!up) return false;
    if(up==='A' || ['10','J','Q','K'].includes(up)){
      const bj = handValue(dealer).total===21; return bj; // keep hole down until dealerPlay
    }
    return false;
  }

  function current(){ return hands[active]; }

  async function hit(){ if(!inRound) return; const h=current(); const c=draw(); await flyCard(h.dom.cards, c); h.cards.push(c); firstAction=false; render(); if(handValue(h.cards).total>21) await nextHand(); }
  async function stand(){ if(!inRound) return; await nextHand(); }
  async function double(){ const h=current(); if(!firstAction || bankroll<h.bet) return; bankroll-=h.bet; h.bet*=2; render(); await flyChip(bankEl.parentElement.parentElement, h.dom.betCircle); const c=draw(); await flyCard(h.dom.cards,c); h.cards.push(c); firstAction=false; render(); await nextHand(); }
  async function split(){ const h=current(); if(!(firstAction && h.cards.length===2 && bankroll>=h.bet && sameValue(h.cards[0],h.cards[1]))) return; bankroll-=h.bet; const c1=h.cards[0], c2=h.cards[1]; hands.splice(active,1,{cards:[c1],bet:h.bet,finished:false},{cards:[c2],bet:h.bet,finished:false}); render(); await flyChip(bankEl.parentElement.parentElement, hands[0].dom.betCircle || playersEl); const n1=draw(), n2=draw(); await flyCard(hands[active].dom.cards,n1); hands[active].cards.push(n1); render(); await flyCard(hands[active+1].dom.cards,n2); hands[active+1].cards.push(n2); render(); setStage('acting'); }
  async function surrender(){ if(!firstAction) return; bankroll += Math.floor(current().bet/2); inRound=false; setStage('idle'); msg('Surrendered'); render(); }

  async function nextHand(){
    current().finished=true; firstAction=true; active++;
    if(active >= hands.length){ await dealerPlay(); await settle(); }
    else { setStage('acting'); render(); }
  }

  async function dealerPlay(){
    // reveal and draw to 17 (stand on soft 17)
    holeDown=false; render(); await sleep(200);
    let hv = handValue(dealer);
    while(hv.total < 17){ const c=draw(); await flyCard(dealerCardsEl,c); dealer.push(c); render(); hv = handValue(dealer); }
  }

  async function finishRound(){
    // used for naturals handling
    await dealerPlay();
    await settle();
  }

  async function settle(){
    const d = handValue(dealer).total;
    let win=0;
    for(const h of hands){
      const p = handValue(h.cards).total;
      let out='lose';
      if(p>21) out='lose';
      else if(d>21 || p>d) out='win';
      else if(p<d) out='lose';
      else out='push';
      const playerBJ = (p===21 && h.cards.length===2);
      const dealerBJ = (d===21 && dealer.length===2);
      if(playerBJ && !dealerBJ) out='blackjack';
      if(out==='blackjack'){ bankroll += h.bet + Math.floor(h.bet*2.5); win += Math.floor(h.bet*1.5); }
      else if(out==='win'){ bankroll += h.bet*2; win += h.bet; }
      else if(out==='push'){ bankroll += h.bet; }
    }
    // chips back to bank (visual)
    if(win>0){ await flyChip(playersEl, bankEl.parentElement.parentElement); }
    inRound=false; setStage('idle'); render(); msg(win>0?`You won $${win}`:'You lose');
  }

  // ===== Wire up =====
  dealBtn.addEventListener('click', ()=>{ startRound(); });
  newShoeBtn.addEventListener('click', ()=>{ freshShoe(); msg('Fresh 6‑deck shoe'); });
  hitBtn.addEventListener('click', ()=>{ hit(); });
  standBtn.addEventListener('click', ()=>{ stand(); });
  doubleBtn.addEventListener('click', ()=>{ double(); });
  splitBtn.addEventListener('click', ()=>{ split(); });
  surrenderBtn.addEventListener('click', ()=>{ surrender(); });
  betInput.addEventListener('change', ()=>{ bet=Math.max(1,Math.floor(Number(betInput.value)||10)); betInput.value=String(bet); betDisp.textContent=String(bet); });

  // init
  freshShoe(); setStage('idle'); render();
})();
</script>
</body>
</html>
